<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="Board">
	<select id="getCount" resultType="Integer">
		select count( * ) from board
	</select>
	
	<select id="getArticles" parameterType="Map" resultType="dto.BoardDataBean">
		select num,writer,email,subject,passwd, reg_date,ref,re_step
		,re_level,content,ip,readcount,r from (select num,writer,email,subject,passwd,reg_date,ref,re_step 
		,re_level,content,ip,readcount,rownum r from 
		(select num,writer,email,subject,passwd,reg_date,ref,re_step,re_level 
		,content,ip,readcount from board order by ref desc, re_step asc) 
		order by ref desc, re_step asc ) where r &gt;= #{start} and r &lt;= #{end}
	</select>
	
	<select id="maxNum" resultType="Integer">
		select max( num ) from board
	</select>
	
	<update id="insertUpdate" parameterType="dto.BoardDataBean">
		update board set re_step=re_step+1 where ref=#{ref} and re_step>#{re_step}
	</update>
	
	<update id="insertArticle" parameterType="dto.BoardDataBean">
		insert into board( num, writer, email, subject, passwd, 
		reg_date, ref, re_step, re_level, content, ip)
		values( board_seq.NEXTVAL, #{writer}, #{email, jdbcType=VARCHAR}, #{subject},
		 #{passwd}, #{reg_date}, #{ref}, #{re_step}, #{re_level}, #{content}, #{ip})
	</update>
	
	<select id="getArticle" parameterType="Integer" resultType="dto.BoardDataBean">
		select * from board where num=#{num}
	</select>
	
	<update id="addCount" parameterType="Integer">
		update board set readcount=readcount+1 where num=#{num}
	</update>
	
	<update id="updateArticle" parameterType="dto.BoardDataBean">
		update board set email=#{email, jdbcType=VARCHAR}, subject=#{subject}, content=#{content}, passwd=#{passwd} where num=#{num}
	</update>
	
	<select id="deletCount" parameterType="dto.BoardDataBean" resultType="Integer">
		select count(*) from board where ref=#{ref} and re_step=#{re_step}+1 and re_level>#{re_level}
	</select>
	
	<update id="deletUpdate" parameterType="dto.BoardDataBean">
		update board set re_step=re_step-1 where ref=#{ref} and re_step>#{re_step}
	</update>
	
	<delete id="deletArticle" parameterType="Integer">
		delete from board where num=#{num}
	</delete>
</mapper>	








